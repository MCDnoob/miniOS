# 内核加载器

- 写内核加载器loader
- 将loader写入硬盘
- 在主引导扇区读入
- 检测正确性
- 跳转到loader执行

在Makefile中，将内核加载器`loader`写入磁盘master的第二个扇区，然后占用最多4个扇区：
```console
dd if=loader.bin of=master.img bs=512 count=4 seek=2 conv=notrunc
```
然后，将这段代码放在内存`0x1000`处，正位于实模式可用区域`0x500`~`0x7BFF`中。

所以，在`boot.asm`中，读取磁盘直接从`0x1000`读取，开始位置为`master.img`的第二个扇区。

## 实模式的内存布局

| 起始地址  | 结束地址  | 大小     | 用途               |
| --------- | --------- | -------- | ------------------ |
| `0x000`   | `0x3FF`   | 1KB      | 中断向量表         |
| `0x400`   | `0x4FF`   | 256B     | BIOS 数据区        |
| `0x500`   | `0x7BFF`  | 29.75 KB | 可用区域           |
| `0x7C00`  | `0x7DFF`  | 512B     | MBR 加载区域       |
| `0x7E00`  | `0x9FBFF` | 607.6KB  | 可用区域           |
| `0x9FC00` | `0x9FFFF` | 1KB      | 扩展 BIOS 数据区   |
| `0xA0000` | `0xAFFFF` | 64KB     | 用于彩色显示适配器 |
| `0xB0000` | `0xB7FFF` | 32KB     | 用于黑白显示适配器 |
| `0xB8000` | `0xBFFFF` | 32KB     | 用于文本显示适配器 |
| `0xC0000` | `0xC7FFF` | 32KB     | 显示适配器 BIOS    |
| `0xC8000` | `0xEFFFF` | 160KB    | 映射内存           |
| `0xF0000` | `0xFFFEF` | 64KB-16B | 系统 BIOS          |
| `0xFFFF0` | `0xFFFFF` | 16B      | 系统 BIOS 入口地址 |

