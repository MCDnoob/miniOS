# 2. boot主引导扇区
## boot.asm
主引导扇区
在`src`中创建`boot.asm`

编译：
```console
nasm -f bin boot.asm -o boot.bin
```

## 创建硬盘镜像
```console
bximage -q -hd=16 -func=create -sectsize=512 -imgmode=flat master.img
```
将boot.bin 写入主引导扇区
```console
dd if=boot.bin of=master.img bs=512 count=1 conv=notrunc
```
## 配置bochsrc
在`src`中创建`bochsrc`:
```console
bochs
4
bochsrc
7
```
然后，将`ata0-master`替换成如下
`ata0-master: type=disk, path="master.img", mode=flat`
将
`romimage: file="/usr/local/share/bochs/BIOS-bochs-latest", address=0x00000000, options=none, flash_data=none`
替换成
`romimage: file="/usr/local/share/bochs/BIOS-bochs-legacy", address=0x00000000, options=none, flash_data=none`

将`boot: floppy`改为`boot: disk`

在`display_library: x`后面加上
`display_library: x, options="gui_debug"`



```s
[org 0x7c00]
; 代码的起始位置在内存0x7c00

; 设置屏幕模式为文本模式，清除屏幕
mov ax, 3
int 0x10

; 初始化段寄存器
mov ax, 0
mov ds, ax
mov es, ax
mov ss, ax
mov sp, 0x7c00  ; 设置栈的起始位置就是0x7c00
; 0xb8000屏幕文本显示器的内存
mov ax, 0xb800
mov ds, ax
mov byte [0], 'H'
mov byte [2], 'e'
mov byte [4], 'l'
mov byte [6], 'l'
mov byte [8], 'o'
mov byte [10], ' '
mov byte [12], 'w'
mov byte [14], 'o'
mov byte [16], 'r'
mov byte [18], 'l'
mov byte [20], 'd'
mov byte [22], '!'
mov byte [24], '!'
mov byte [26], '!'

; 阻塞，$表示当前这一行
jmp $

; 主引导扇区的其他字节用0填充，$$表示起始行
times 510 - ($ - $$) db 0

; 主引导扇区512字节的最后两个字节必须是0x55和0xaa
db 0x55, 0xaa
```